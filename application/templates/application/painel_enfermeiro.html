{% extends "application/base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/painel_enfermeiro.css' %}">
<link rel="stylesheet" href="{% static 'css/painel_medico.css' %}">
<link rel="stylesheet" href="{% static 'css/medico_pacientes.css' %}">

{% if messages %}
<div class="mensagens">
    {% for message in messages %}
        <div class="alerta {{ message.tags }}">
            {{ message }}
        </div>
    {% endfor %}
</div>
{% endif %}

<div class="container-principal">
    <aside class="coluna-menu-lateral">
        <ul class="lista-navegacao">
            <li class="item-menu">
                <a class="link-menu ativo" href="#" onclick="mostrarConteudo('home', this)">Home</a>
            </li>
            <li class="item-menu">
                <a class="link-menu" href="#" onclick="mostrarConteudo('pacientes', this)">Pacientes</a>
            </li>
            <li class="item-menu">
                <a class="link-menu" href="#" onclick="mostrarConteudo('cadastro', this)">Cadastrar Paciente</a>
            </li>
            <li class="item-menu">
                <a class="link-menu" href="#" onclick="mostrarConteudo('consultas', this)">Cadastrar Consulta</a>
            </li>
            <li class="item-menu">
                <a class="link-menu" href="#" onclick="mostrarConteudo('andares', this)">Andares e Quartos</a>
            </li>
        </ul>
    </aside>

    <main class="coluna-conteudo-principal">
        <header class="cabecalho-pagina">
            <h1 class="titulo-pagina" id="titulo-pagina">Bem-vindo(a), {{ enfermeiro.usuario.nome_completo }}</h1>
        </header>

        <!-- Seção Home -->
        <section id="home-content">
            <p>Escolha uma opção no menu lateral para começar.</p>
        </section>

        <!-- Seção Pacientes -->
        <section id="pacientes-content" style="display: none;">
            <div class="cartao">
                <div class="corpo-cartao">
                    {% if pacientes %}
                    <div class="grade-pacientes">
                        {% for paciente in pacientes %}
                        <div class="cartao-paciente">
                            <!-- Conteúdo dos pacientes... (mantenha igual ao original) -->
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="sem-resultados">Nenhum paciente cadastrado</p>
                    {% endif %}
                </div>
            </div>
        </section>

        <!-- Seção Cadastro -->
        <section id="cadastro-content" style="display: none;">
            {% include 'application/cadastrar_paciente.html' %}
        </section>

        <!-- Seção Consultas -->
        <section id="consultas-content" style="display: none;">
            <form method="post" action="{% url 'consultas:cadastrar_consulta' %}">
                <!-- Formulário de consultas... (mantenha igual ao original) -->
            </form>
        </section>

        <!-- Seção Andares e Quartos (nova seção) -->
        <section id="andares-content" style="display: none;">
            <div class="container mt-4">
                <h2 class="mb-4">Controle de Andares e Quartos</h2>
                
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5>Atribuir Paciente a Quarto</h5>
                    </div>
                    <div class="card-body">
                        <form method="post">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="andar">Andar:</label>
                                        <select class="form-control" id="andar" name="andar" required>
                                            <option value="">Selecione um andar</option>
                                            {% for andar in andares %}
                                            <option value="{{ andar.id }}">{{ andar }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="numero">Número do Quarto:</label>
                                        <input type="number" class="form-control" id="numero" name="numero" min="1" max="10" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="paciente">Paciente:</label>
                                        <select class="form-control" id="paciente" name="paciente" required>
                                            <option value="">Selecione um paciente</option>
                                            {% for paciente in pacientes_sem_quarto %}
                                            <option value="{{ paciente.id }}">{{ paciente.nome }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary mt-2">Atribuir Quarto</button>
                        </form>
                    </div>
                </div>

                {% for andar, quartos in quartos_por_andar.items %}
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h5>{{ andar }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% for quarto in quartos %}
                            <div class="col-md-4 mb-3">
                                <div class="card {% if quarto.paciente %}border-success{% else %}border-secondary{% endif %}">
                                    <div class="card-header">
                                        <strong>Quarto {{ quarto.numero }}</strong>
                                    </div>
                                    <div class="card-body">
                                        {% if quarto.paciente %}
                                            <p class="text-success">
                                                <strong>Paciente:</strong> {{ quarto.paciente.nome }}<br>
                                                <strong>ID:</strong> {{ quarto.paciente.id }}
                                            </p>
                                            <a href="{% url 'liberar_quarto' quarto.id %}" class="btn btn-sm btn-warning">Liberar Quarto</a>
                                        {% else %}
                                            <p class="text-muted">Vago</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
    </main>
</div>

<script>
    function mostrarConteudo(tipo, elemento) {
        document.querySelectorAll('.link-menu').forEach(link => link.classList.remove('ativo'));
        if (elemento) elemento.classList.add('ativo');
        const secoes = ['home', 'pacientes', 'cadastro', 'consultas', 'andares'];
        secoes.forEach(sec => {
            document.getElementById(`${sec}-content`).style.display = sec === tipo ? 'block' : 'none';
        });
        const titulo = document.getElementById('titulo-pagina');
        if (tipo === 'home') {
            titulo.textContent = "Bem-vindo(a), {{ enfermeiro.usuario.nome_completo }}";
        } else {
            titulo.textContent = tipo.charAt(0).toUpperCase() + tipo.slice(1).replace('_', ' ');
        }
        
        window.location.hash = tipo;
    }

    document.addEventListener("DOMContentLoaded", function() {
        const hash = window.location.hash.substring(1);
        if (hash && ['home', 'pacientes', 'cadastro', 'consultas', 'andares'].includes(hash)) {
            const elemento = document.querySelector(`.link-menu[href="#"]`);
            mostrarConteudo(hash, elemento);
        }

        document.querySelectorAll(".botao-dropdown").forEach(function(btn) {
            btn.addEventListener("click", function(e) {
                e.preventDefault();
                const targetId = btn.getAttribute("data-dropdown-target");
                const dropdown = document.getElementById(targetId);
                if (dropdown) {
                    dropdown.classList.toggle("mostrar");
                }
            });
        });
    });
</script>
{% endblock %}